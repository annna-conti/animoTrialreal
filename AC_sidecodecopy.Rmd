---
title: "side aminoTrial images"
author: "Annabelle Conti"
date: "2025-08-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


--> command option i will automatically put an r chunk in your code 
--> command shift m will make a pipe 

###
***
This is the analysis pipeline for data generated from TagLab annotations of our peroxide and tunicate trials. 


***
### All analyses performe with R verion `r getRversion()`
# Basic setup of R environment
***
## Loading required packages

For the following analyses we will require the use of a number of different R packages. Most of which can be sourced from CRAN, but some must be downloaded from GitHub. We can use the following code to load in the packages and install any packages not previously installed in the R console.  

```{r, load packages, include = TRUE, message = FALSE, warning = FALSE, results = 'hide'}
if (!require("pacman")) install.packages("pacman")
pacman::p_load("ggplot2","officer","ggpubr", "rcompanion", "RColorBrewer", "patchwork", "magrittr","reshape2", "stringr", "plyr", "dplyr", "flextable", "tidyr", "tibble", "vegan", "paletteer", "purrr")
```

<br><br> 

# Loading and Manipulating data
***

We have loaded a lot of individual data into R and we want to combine the data and create one cohesive dataframe with which to work. In order to do that we have to add a few identifiers to our data frames to when combining we can differentiate between the two, but this is also a good time to add other columns like **treatment** and **time** as well. The majority of this is done using various functions from the package `dplyr`. 
```{r}
read_plus <- function(flnm) {
  read.csv(flnm) %>%
    mutate_all(as.character) %>%
    mutate(filename = flnm)
}
#code i used to combine each picture into a csv 
# T2
sideT2 <- list.files(path = "./T2", pattern = "*.csv", full.names = TRUE) %>%
  map_df(~read_plus(.)) %>%
  mutate(timePoint = "T2")
sideT2

sideT3 <- list.files(path = "./T3", pattern = "*.csv", full.names = TRUE) %>%
  map_df(~read_plus(.))%>%
  mutate(timePoint = "T3")
sideT3

sideT4 <- list.files(path = "./T4", pattern = "*.csv", full.names = TRUE) %>%
  map_df(~read_plus(.)) %>% 
  mutate(timePoint = "T4")
sideT4

sideT5 <- list.files(path = "./T5", pattern = "*.csv", full.names = TRUE) %>%
  map_df(~read_plus(.)) %>% 
  mutate(timePoint = 'T5')
sideT5

sideT6 <- list.files(path = "./T6", pattern = "*.csv", full.names = TRUE) %>%
  map_df(~read_plus(.)) %>% 
  mutate(timePoint = "T6")
sideT6

tagData1 <- rbind(sideT2, sideT3, sideT4, sideT5, sideT6)


tagData <- tagData1 %>%
  mutate(clean_name = str_remove(basename(filename), ".csv")) %>%
  separate(
    clean_name,
    into = c("Genet", "fragSize", "treatment", "individual", "timePoint"),
    sep = "_") %>% 
  select(c(TagLab.Date, timePoint, treatment, Genet, fragSize, TagLab.Class.name, TagLab.Area)) %>% 
  mutate(treatment = str_replace(treatment, "30mins", "30min")) %>% 
  rename(Date = TagLab.Date, 
         Individual = TagLab.Class.name, 
         Area = TagLab.Area) %>% 
  mutate(across(c(treatment, Genet, fragSize, timePoint, Individual), as.factor)) %>% 
  mutate(Area = as.numeric(Area))

         


```


```{r}

# Step 2: summarize to ensure one value per genet + ID + timepoint
tagDataSum <- tagData %>%
  group_by(Genet, Individual, timePoint, fragSize, treatment) %>%
  dplyr::summarize(meanArea = mean(Area, na.rm = TRUE))

# # Step 3: pivot wider
# tagDatawide <- tagDataSumm %>%
#   pivot_wider(
#     names_from = timepoint,
#     values_from = area
#   ) %>%
#   arrange(genet, ID) %>%
#   # Step 4: add treatment column based on ID
#   mutate(
#     treatment = case_when(
#       ID >= 1  & ID <= 10 ~ "control",
#       ID >= 11 & ID <= 20 ~ "30min",
#       ID >= 21 & ID <= 30 ~ "1hr",
#       TRUE ~ NA_character_
#     )
#   ) %>%
#   # Step 5: reorder columns: treatment first
#   select(treatment, genet, ID, frag_size, everything())
# 
# # Step 6: view final table
# View(tagDatawide)

```


visualizing the data

```{r}

myColors <- paletteer_c("pals::ocean.balance", 18, direction = 1)
stackTheme <- theme(
    # Title
    plot.title = element_text(size = 40, face = "bold"), 
    # X Axis
    axis.text.x = element_text(size = 40, colour = "black", vjust = 0.5, hjust = 0.5, face= "bold"), 
    axis.title.x = element_blank(),
    # Y Axis
    axis.title.y = element_text(size = 40, face = "bold"), 
    axis.text.y = element_text(colour = "black", size = 40, face = "bold"),
    # Axis Lines and Ticks
    axis.line = element_line(colour = "black"), 
    axis.ticks = element_line(color="black"), 
    # Legend
    legend.title = element_text(size = 36, face = "bold"), 
    legend.text = element_text(size = 20, face = "bold", colour = "black"), 
    legend.position = "right",
    # Grid and Background
    panel.grid.major = element_line(size = 0.5, linetype = 'solid', colour = "black"),
    panel.background = element_rect(fill = '#D3D3D3'), 
    # Text
    text = element_text(size=40, color="black"), 
    #rectangle
    rect = element_rect(fill = "transparent"),
    # Facet Labels
    strip.text = element_text(size = 30))





tagStack <- ggplot(tagDataSum, aes(x = timePoint, y = meanArea, fill = timePoint))+
  geom_boxplot()+
  geom_point(shape = 20, aes(color = Genet, fill = Genet))+
  # ylim(0,800)+
  # labs(y = "Area of Tunicate (cm2)", fill = "Time Point", title = "Tissue Area of Invasive Tunicate")+stackTheme
  facet_wrap(. ~ treatment, scales = 'free')


tagData_mean <- tagData %>%
  group_by(treatment, timePoint) %>%
  summarise(meanArea = mean(Area, na.rm = TRUE), .groups = "drop")


tagStack <- ggplot(tagData_mean, aes(x = timePoint, y = meanArea, fill = treatment))+
                      geom_bar(stat = 'identity', position = 'dodge')
+
                      # ylim(0,800)+
                      # labs(y = "Area of Tunicate (cm2)", fill = "Time Point", title = "Tissue Area of Invasive Tunicate")+stackTheme
  # facet_wrap(. ~ Genet, scales = 'free' )



```





